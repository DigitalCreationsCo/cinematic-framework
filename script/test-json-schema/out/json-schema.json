{
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "properties": {
        "projectId": {
          "description": "Pipeline project id",
          "type": "string",
          "minLength": 1,
          "format": "uuid",
          "pattern": "^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-7[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$"
        },
        "title": {
          "default": "",
          "description": "title of the video",
          "type": "string"
        },
        "totalScenes": {
          "default": 0,
          "description": "total number of scenes",
          "type": "number"
        },
        "style": {
          "default": "",
          "description": "inferred cinematic style",
          "type": "string"
        },
        "mood": {
          "default": "",
          "description": "overall emotional arc",
          "type": "string"
        },
        "colorPalette": {
          "default": [],
          "description": "dominant colors",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "tags": {
          "default": [],
          "description": "descriptive tags",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "duration": {
          "default": 0,
          "description": "Total duration in seconds",
          "type": "number"
        },
        "bpm": {
          "type": "number",
          "description": "The detected beats per minute of the track."
        },
        "keySignature": {
          "type": "string",
          "description": "The estimated musical key (e.g., C Minor, G Major)."
        },
        "models": {
          "default": {},
          "type": "object",
          "properties": {
            "videoModel": {
              "description": "AI model used for video generation",
              "type": "string"
            },
            "imageModel": {
              "description": "AI model used for image generation",
              "type": "string"
            },
            "textModel": {
              "description": "AI model used for text generation",
              "type": "string"
            },
            "qaModel": {
              "description": "AI model used for quality evaluation",
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "initialPrompt": {
          "type": "string",
          "description": "original creative prompt"
        },
        "enhancedPrompt": {
          "description": "enhanced user prompt with narrative, characters, settings",
          "type": "string"
        },
        "audioGcsUri": {
          "description": "GCS URI of uploaded audio file",
          "type": "string"
        },
        "audioPublicUri": {
          "description": "audio file public url",
          "type": "string"
        },
        "hasAudio": {
          "default": false,
          "description": "whether this workflow has user-provided audio",
          "type": "boolean"
        }
      },
      "required": [
        "projectId",
        "title",
        "totalScenes",
        "style",
        "mood",
        "colorPalette",
        "tags",
        "models",
        "initialPrompt",
        "hasAudio"
      ],
      "additionalProperties": false
    },
    "characters": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "referenceId": {
            "type": "string",
            "description": "unique identifier for the character (e.g. char_1)"
          },
          "name": {
            "type": "string",
            "description": "character name"
          },
          "aliases": {
            "default": [],
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "list of aliases for the character"
          },
          "age": {
            "type": "string",
            "description": "age or age range"
          },
          "physicalTraits": {
            "type": "object",
            "properties": {
              "hair": {
                "type": "string",
                "description": "specific hairstyle, color, length, texture"
              },
              "clothing": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "specific outfit description (string or array of garments)"
              },
              "accessories": {
                "default": [],
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "list of accessories"
              },
              "distinctiveFeatures": {
                "default": [],
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "list of distinctive features"
              },
              "build": {
                "description": "physical build description",
                "type": "string"
              },
              "ethnicity": {
                "description": "ethnicity description (generic, non-specific)",
                "type": "string"
              }
            },
            "required": [
              "hair",
              "clothing",
              "accessories",
              "distinctiveFeatures"
            ],
            "additionalProperties": false
          },
          "appearanceNotes": {
            "default": [],
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "additional notes on appearance"
          },
          "state": {
            "type": "object",
            "properties": {
              "lastSeen": {
                "description": "scene ID where character was last seen",
                "type": "string"
              },
              "position": {
                "description": "character's spatial position: left/center/right, foreground/background",
                "type": "string"
              },
              "lastExitDirection": {
                "description": "direction character exited frame in previous scene",
                "type": "string",
                "enum": [
                  "left",
                  "right",
                  "up",
                  "down",
                  "none"
                ]
              },
              "emotionalState": {
                "description": "character's current emotional state",
                "type": "string"
              },
              "emotionalHistory": {
                "default": [],
                "description": "emotional state timeline across scenes",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "sceneId": {
                      "type": "string"
                    },
                    "emotion": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "sceneId",
                    "emotion"
                  ],
                  "additionalProperties": false
                }
              },
              "physicalCondition": {
                "description": "accumulated damage, dirt, exhaustion",
                "type": "string"
              },
              "injuries": {
                "default": [],
                "description": "injuries that persist across scenes",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "severity": {
                      "type": "string",
                      "enum": [
                        "minor",
                        "moderate",
                        "severe"
                      ]
                    },
                    "acquiredInScene": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "type",
                    "location",
                    "severity",
                    "acquiredInScene"
                  ],
                  "additionalProperties": false
                }
              },
              "dirtLevel": {
                "default": "clean",
                "description": "accumulation of dirt, mud, dust",
                "type": "string",
                "enum": [
                  "clean",
                  "slightly_dirty",
                  "dirty",
                  "very_dirty",
                  "covered"
                ]
              },
              "exhaustionLevel": {
                "default": "fresh",
                "description": "progressive fatigue",
                "type": "string",
                "enum": [
                  "fresh",
                  "slightly_tired",
                  "tired",
                  "exhausted",
                  "collapsing"
                ]
              },
              "sweatLevel": {
                "default": "dry",
                "description": "perspiration level",
                "type": "string",
                "enum": [
                  "dry",
                  "slight",
                  "moderate",
                  "heavy",
                  "drenched"
                ]
              },
              "costumeCondition": {
                "description": "progressive costume degradation",
                "type": "object",
                "properties": {
                  "tears": {
                    "default": [],
                    "description": "torn areas (e.g., 'sleeve torn', 'pants ripped at knee')",
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "stains": {
                    "default": [],
                    "description": "stains (e.g., 'blood on shirt', 'mud on pants')",
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "wetness": {
                    "default": "dry",
                    "description": "moisture level of clothing",
                    "type": "string",
                    "enum": [
                      "dry",
                      "damp",
                      "wet",
                      "soaked"
                    ]
                  },
                  "damage": {
                    "default": [],
                    "description": "other damage (e.g., 'burned collar', 'missing button')",
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "tears",
                  "stains",
                  "wetness",
                  "damage"
                ],
                "additionalProperties": false
              },
              "hairCondition": {
                "description": "progressive hair state changes",
                "type": "object",
                "properties": {
                  "style": {
                    "description": "current style (should match baseline unless narrative justification)",
                    "type": "string"
                  },
                  "messiness": {
                    "default": "pristine",
                    "type": "string",
                    "enum": [
                      "pristine",
                      "slightly_messy",
                      "messy",
                      "disheveled",
                      "wild"
                    ]
                  },
                  "wetness": {
                    "default": "dry",
                    "type": "string",
                    "enum": [
                      "dry",
                      "damp",
                      "wet",
                      "soaked"
                    ]
                  }
                },
                "required": [
                  "messiness",
                  "wetness"
                ],
                "additionalProperties": false
              }
            },
            "required": [
              "emotionalHistory",
              "injuries",
              "dirtLevel",
              "exhaustionLevel",
              "sweatLevel"
            ],
            "additionalProperties": false
          }
        },
        "required": [
          "referenceId",
          "name",
          "aliases",
          "age",
          "physicalTraits",
          "appearanceNotes"
        ],
        "additionalProperties": false
      }
    },
    "locations": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "referenceId": {
            "type": "string",
            "description": "narrative-scoped identifier for the location (e.g., loc_1)"
          },
          "name": {
            "type": "string",
            "description": "location name"
          },
          "type": {
            "description": "location type (beach, urban, warehouse, etc.)",
            "type": "string"
          },
          "lightingConditions": {
            "type": "object",
            "properties": {
              "quality": {
                "type": "object",
                "properties": {
                  "Hardness": {
                    "description": "e.g. Soft (diffused, gentle shadows), Hard (sharp, defined shadows)",
                    "type": "string"
                  },
                  "colorTemperature": {
                    "description": "Warm (2700-3500K), Neutral (4000-5000K), Cool (5500-7000K)",
                    "type": "string"
                  },
                  "intensity": {
                    "description": "e.g., Low (dim, moody), Medium (balanced), High (bright, energetic)",
                    "type": "string"
                  }
                },
                "additionalProperties": false,
                "description": "Lighting quality specification, "
              },
              "motivatedSources": {
                "type": "object",
                "properties": {
                  "Primary Light": {
                    "description": "e.g., Sun through window, street lamp, overhead ceiling, firelight, etc",
                    "type": "string"
                  },
                  "Fill Light": {
                    "description": "e.g., Ambient skylight, reflected surfaces, secondary practicals",
                    "type": "string"
                  },
                  "Practical Lights": {
                    "type": "string",
                    "description": "List visible light sources in frame: lamps, candles, screens"
                  },
                  "Accent Light": {
                    "description": "e.g., Rim light from behind, side window, bounce from ground",
                    "type": "string"
                  },
                  "Light Beams": {
                    "type": "string",
                    "description": "e.g., Visible shafts, rays, None"
                  }
                },
                "required": [
                  "Practical Lights",
                  "Light Beams"
                ],
                "additionalProperties": false,
                "description": "Light sources"
              },
              "direction": {
                "type": "object",
                "properties": {
                  "Key Light Position": {
                    "description": "e.g., Front - left, right 45°, Side 90°, Back 135 - 180°, Top-down, etc",
                    "type": "string"
                  },
                  "Shadow Direction": {
                    "description": "e.g, Falling left, right, forward, behind subject, etc",
                    "type": "string"
                  },
                  "Contrast Ratio": {
                    "description": "e.g., Low(1: 2) flat, Medium(1: 4) standard, High(1: 8 +) dramatic, etc",
                    "type": "string"
                  }
                },
                "additionalProperties": false,
                "description": "Key light position, shadow direction"
              },
              "atmosphere": {
                "type": "object",
                "properties": {
                  "Haze": {
                    "type": "string",
                    "description": "e.g., None, Light mist, Dense fog"
                  }
                },
                "required": [
                  "Haze"
                ],
                "additionalProperties": false,
                "description": "Atmospheric lighting effects"
              }
            },
            "required": [
              "quality",
              "motivatedSources",
              "direction",
              "atmosphere"
            ],
            "additionalProperties": false
          },
          "timeOfDay": {
            "type": "string",
            "description": "initial time of day"
          },
          "weather": {
            "default": "Clear",
            "type": "string",
            "description": "initial weather conditions"
          },
          "colorPalette": {
            "default": [],
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "dominant colors"
          },
          "mood": {
            "type": "string",
            "description": "atmospheric mood"
          },
          "architecture": {
            "type": "string",
            "description": "architectural features"
          },
          "naturalElements": {
            "default": [],
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "natural elements in scene"
          },
          "manMadeObjects": {
            "default": [],
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "man-made objects in scene"
          },
          "groundSurface": {
            "type": "string",
            "description": "ground surface description"
          },
          "skyOrCeiling": {
            "type": "string",
            "description": "sky or ceiling description"
          },
          "state": {
            "type": "object",
            "properties": {
              "lastUsed": {
                "description": "scene ID where location was last used",
                "type": "string"
              },
              "timeOfDay": {
                "description": "current time of day (evolves across scenes)",
                "type": "string"
              },
              "timeHistory": {
                "default": [],
                "description": "time progression timeline",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "sceneId": {
                      "type": "string"
                    },
                    "timeOfDay": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "sceneId",
                    "timeOfDay"
                  ],
                  "additionalProperties": false
                }
              },
              "weather": {
                "description": "current weather conditions",
                "type": "string"
              },
              "weatherHistory": {
                "default": [],
                "description": "weather evolution across scenes",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "sceneId": {
                      "type": "string"
                    },
                    "weather": {
                      "type": "string"
                    },
                    "intensity": {
                      "type": "string",
                      "enum": [
                        "light",
                        "moderate",
                        "heavy",
                        "extreme"
                      ]
                    }
                  },
                  "required": [
                    "sceneId",
                    "weather"
                  ],
                  "additionalProperties": false
                }
              },
              "precipitation": {
                "default": "none",
                "description": "current precipitation level",
                "type": "string",
                "enum": [
                  "none",
                  "light",
                  "moderate",
                  "heavy"
                ]
              },
              "visibility": {
                "default": "clear",
                "description": "atmospheric visibility",
                "type": "string",
                "enum": [
                  "clear",
                  "slight_haze",
                  "hazy",
                  "foggy",
                  "obscured"
                ]
              },
              "lighting": {
                "type": "object",
                "properties": {
                  "quality": {
                    "type": "object",
                    "properties": {
                      "Hardness": {
                        "description": "e.g. Soft (diffused, gentle shadows), Hard (sharp, defined shadows)",
                        "type": "string"
                      },
                      "colorTemperature": {
                        "description": "Warm (2700-3500K), Neutral (4000-5000K), Cool (5500-7000K)",
                        "type": "string"
                      },
                      "intensity": {
                        "description": "e.g., Low (dim, moody), Medium (balanced), High (bright, energetic)",
                        "type": "string"
                      }
                    },
                    "additionalProperties": false,
                    "description": "Lighting quality specification, "
                  },
                  "motivatedSources": {
                    "type": "object",
                    "properties": {
                      "Primary Light": {
                        "description": "e.g., Sun through window, street lamp, overhead ceiling, firelight, etc",
                        "type": "string"
                      },
                      "Fill Light": {
                        "description": "e.g., Ambient skylight, reflected surfaces, secondary practicals",
                        "type": "string"
                      },
                      "Practical Lights": {
                        "type": "string",
                        "description": "List visible light sources in frame: lamps, candles, screens"
                      },
                      "Accent Light": {
                        "description": "e.g., Rim light from behind, side window, bounce from ground",
                        "type": "string"
                      },
                      "Light Beams": {
                        "type": "string",
                        "description": "e.g., Visible shafts, rays, None"
                      }
                    },
                    "required": [
                      "Practical Lights",
                      "Light Beams"
                    ],
                    "additionalProperties": false,
                    "description": "Light sources"
                  },
                  "direction": {
                    "type": "object",
                    "properties": {
                      "Key Light Position": {
                        "description": "e.g., Front - left, right 45°, Side 90°, Back 135 - 180°, Top-down, etc",
                        "type": "string"
                      },
                      "Shadow Direction": {
                        "description": "e.g, Falling left, right, forward, behind subject, etc",
                        "type": "string"
                      },
                      "Contrast Ratio": {
                        "description": "e.g., Low(1: 2) flat, Medium(1: 4) standard, High(1: 8 +) dramatic, etc",
                        "type": "string"
                      }
                    },
                    "additionalProperties": false,
                    "description": "Key light position, shadow direction"
                  },
                  "atmosphere": {
                    "type": "object",
                    "properties": {
                      "Haze": {
                        "type": "string",
                        "description": "e.g., None, Light mist, Dense fog"
                      }
                    },
                    "required": [
                      "Haze"
                    ],
                    "additionalProperties": false,
                    "description": "Atmospheric lighting effects"
                  }
                },
                "required": [
                  "quality",
                  "motivatedSources",
                  "direction",
                  "atmosphere"
                ],
                "additionalProperties": false
              },
              "lightingHistory": {
                "default": [],
                "description": "lighting changes timeline",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "sceneId": {
                      "type": "string"
                    },
                    "lighting": {
                      "type": "object",
                      "properties": {
                        "quality": {
                          "type": "object",
                          "properties": {
                            "Hardness": {
                              "description": "e.g. Soft (diffused, gentle shadows), Hard (sharp, defined shadows)",
                              "type": "string"
                            },
                            "colorTemperature": {
                              "description": "Warm (2700-3500K), Neutral (4000-5000K), Cool (5500-7000K)",
                              "type": "string"
                            },
                            "intensity": {
                              "description": "e.g., Low (dim, moody), Medium (balanced), High (bright, energetic)",
                              "type": "string"
                            }
                          },
                          "additionalProperties": false,
                          "description": "Lighting quality specification, "
                        },
                        "motivatedSources": {
                          "type": "object",
                          "properties": {
                            "Primary Light": {
                              "description": "e.g., Sun through window, street lamp, overhead ceiling, firelight, etc",
                              "type": "string"
                            },
                            "Fill Light": {
                              "description": "e.g., Ambient skylight, reflected surfaces, secondary practicals",
                              "type": "string"
                            },
                            "Practical Lights": {
                              "type": "string",
                              "description": "List visible light sources in frame: lamps, candles, screens"
                            },
                            "Accent Light": {
                              "description": "e.g., Rim light from behind, side window, bounce from ground",
                              "type": "string"
                            },
                            "Light Beams": {
                              "type": "string",
                              "description": "e.g., Visible shafts, rays, None"
                            }
                          },
                          "required": [
                            "Practical Lights",
                            "Light Beams"
                          ],
                          "additionalProperties": false,
                          "description": "Light sources"
                        },
                        "direction": {
                          "type": "object",
                          "properties": {
                            "Key Light Position": {
                              "description": "e.g., Front - left, right 45°, Side 90°, Back 135 - 180°, Top-down, etc",
                              "type": "string"
                            },
                            "Shadow Direction": {
                              "description": "e.g, Falling left, right, forward, behind subject, etc",
                              "type": "string"
                            },
                            "Contrast Ratio": {
                              "description": "e.g., Low(1: 2) flat, Medium(1: 4) standard, High(1: 8 +) dramatic, etc",
                              "type": "string"
                            }
                          },
                          "additionalProperties": false,
                          "description": "Key light position, shadow direction"
                        },
                        "atmosphere": {
                          "type": "object",
                          "properties": {
                            "Haze": {
                              "type": "string",
                              "description": "e.g., None, Light mist, Dense fog"
                            }
                          },
                          "required": [
                            "Haze"
                          ],
                          "additionalProperties": false,
                          "description": "Atmospheric lighting effects"
                        }
                      },
                      "required": [
                        "quality",
                        "motivatedSources",
                        "direction",
                        "atmosphere"
                      ],
                      "additionalProperties": false
                    }
                  },
                  "required": [
                    "sceneId",
                    "lighting"
                  ],
                  "additionalProperties": false
                }
              },
              "groundCondition": {
                "description": "progressive ground surface changes",
                "type": "object",
                "properties": {
                  "wetness": {
                    "default": "dry",
                    "type": "string",
                    "enum": [
                      "dry",
                      "damp",
                      "wet",
                      "soaked",
                      "flooded"
                    ]
                  },
                  "debris": {
                    "default": [],
                    "description": "accumulated debris (e.g., 'broken glass', 'fallen leaves')",
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "damage": {
                    "default": [],
                    "description": "environmental damage (e.g., 'crater', 'burn marks')",
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "wetness",
                  "debris",
                  "damage"
                ],
                "additionalProperties": false
              },
              "brokenObjects": {
                "default": [],
                "description": "objects that remain broken across scenes",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "object": {
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    },
                    "brokenInScene": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "object",
                    "description",
                    "brokenInScene"
                  ],
                  "additionalProperties": false
                }
              },
              "atmosphericEffects": {
                "default": [],
                "description": "lingering atmospheric effects",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "description": "smoke, fog, dust, steam, etc."
                    },
                    "intensity": {
                      "type": "string",
                      "enum": [
                        "light",
                        "moderate",
                        "heavy"
                      ]
                    },
                    "addedInScene": {
                      "type": "number"
                    },
                    "dissipating": {
                      "default": false,
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "type",
                    "intensity",
                    "addedInScene",
                    "dissipating"
                  ],
                  "additionalProperties": false
                }
              },
              "season": {
                "description": "seasonal context for consistency",
                "type": "string",
                "enum": [
                  "spring",
                  "summer",
                  "fall",
                  "winter",
                  "unspecified"
                ]
              },
              "temperatureIndicators": {
                "default": [],
                "description": "visual temperature cues (e.g., 'frost on windows', 'heat shimmer')",
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            },
            "required": [
              "timeHistory",
              "weatherHistory",
              "precipitation",
              "visibility",
              "lighting",
              "lightingHistory",
              "brokenObjects",
              "atmosphericEffects",
              "temperatureIndicators"
            ],
            "additionalProperties": false
          }
        },
        "required": [
          "referenceId",
          "name",
          "lightingConditions",
          "timeOfDay",
          "weather",
          "colorPalette",
          "mood",
          "architecture",
          "naturalElements",
          "manMadeObjects",
          "groundSurface",
          "skyOrCeiling"
        ],
        "additionalProperties": false
      }
    }
  },
  "required": [
    "metadata",
    "characters",
    "locations"
  ],
  "additionalProperties": false
}